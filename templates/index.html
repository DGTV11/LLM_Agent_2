<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>LLM_Agent_2</title>
        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body class="p-8">
        <h1 class="font-bold text-8xl pb-8">Agents</h1>
        <div>
            <ul class="list-disc list-inside">
                {% for id, created_at in agent_infos %}
                    <li>
                        <a class="font-bold underline"
                           href="{{ url_for('chat_page', agent_id=id) }}">{{ id }}</a>
                        (created at {{ created_at }})
                        <button type="button"
                                class="fetch-btn font-bold text-red-500"
                                data-url="/api/agents/{{ id }}">Delete</button>
                    </li>
                {% endfor %}
            </ul>
        </div>
        <br>
        <button type="button">
            <a class="font-bold" href="{{ url_for("create_page") }}">Create new agent</a>
        </button>
    </body>
    <script>
  async function deleteAgent(url) {
    const response = await fetch(url, { method: 'DELETE' });
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
    return response.json();
  }

  // Add event listener to all matching buttons
  document.querySelectorAll('.fetch-btn').forEach(button => {
    button.addEventListener('click', async (event) => {
      try {
        const url = event.target.dataset.url;
        await deleteAgent(url);
        event.target.closest('li').remove();
      } catch (error) {
        console.error('Failed to delete agent:', error);
        alert('Error: Could not delete agent.');
      }
    });
  });
    </script>
</html>
