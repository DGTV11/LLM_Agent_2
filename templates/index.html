<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>LLM_Agent_2</title>
        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body class="p-8">
        <h1 class="font-bold text-8xl pb-8">Agents</h1>
        <div>
            <ul class="flex flex-col gap-4">
                {% for id, created_at, optional_function_sets, agent_persona, user_persona, recursive_summary, recursive_summary_update_time in agent_infos %}
                    <li class="border-black border-2 rounded-2xl p-4 flex flex-col gap-2">
                        <div class="flex justify-between items-center">
                            <h2 class="font-bold text-lg">
                                <a href="{{ url_for('chat_page', agent_id=id) }}">{{ id }}</a>
                            </h2>
                            <button type="button"
                                    class="fetch-btn font-bold text-red-500"
                                    data-url="/api/agents/{{ id }}">Delete</button>
                        </div>
                        <p class="text-sm text-gray-500">Created at {{ created_at }}</p>
                        <p class="italic text-gray-700">"{{ agent_persona }}"</p>
                        <div class="mt-2">
                            {% for ofc in optional_function_sets %}
                                <span class="text-xs bg-gray-200 rounded-full px-2 py-0.5">{{ ofc }}</span>
                            {% endfor %}
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
        <br>
        <button type="button">
            <a class="font-bold" href="{{ url_for("create_page") }}">Create new agent</a>
        </button>
    </body>
    <script>
  async function deleteAgent(url) {
    const response = await fetch(url, { method: 'DELETE' });
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
    return response.json();
  }

  // Add event listener to all matching buttons
  document.querySelectorAll('.fetch-btn').forEach(button => {
    button.addEventListener('click', async (event) => {
      try {
        const url = event.target.dataset.url;
        await deleteAgent(url);
        event.target.closest('li').remove();
      } catch (error) {
        console.error('Failed to delete agent:', error);
        alert('Error: Could not delete agent.');
      }
    });
  });
    </script>
</html>
